@(user: User, q: uk.bl.wa.shine.Query, currentPage: uk.bl.wa.shine.Pagination, currentSortBy: String, currentOrder: String)

@****************************************
* Helper generating navigation links    *
****************************************@
@link(pageNo:Int, newSortBy:String) = @{
    
    var sortBy = currentSortBy
    var order = currentOrder
    
    if(newSortBy != null) {
        sortBy = newSortBy
        if(currentSortBy == newSortBy) {
            if(currentOrder == "asc") {
                order = "desc"
            } else {
                order = "asc"
            }
        } else {
            order = "asc"
        }
    }

    // Generate the link
    routes.Search.search(q.query, pageNo, sortBy, order)
}

@pagination = {
	@if(currentPage != null && currentPage.getTotalItems > 0) {
		<div class="text-center paging-tabs">
			<ul class="pagination">
				@if(currentPage.hasPreviousPage) {
	            	<li class="prev">
	            		@if(q.mode != null) {
	            			<a href="@link(currentPage.getCurrentPage-1, null)@(q.responseParameters)&tab=results&action=search&mode=@(q.mode)" id="page-@(currentPage.getCurrentPage-1)" class="paging" data-toggle="tooltip" data-placement="left" title="Page @(currentPage.getCurrentPage-1)">&laquo;</a>
	            		} else {
	            			<a href="@link(currentPage.getCurrentPage-1, null)@(q.responseParameters)&tab=results&action=search" id="page-@(currentPage.getCurrentPage-1)" class="paging" data-toggle="tooltip" data-placement="left" title="Page @(currentPage.getCurrentPage-1)">&laquo;</a>
	            		}
	                </li>
	            } else {
	                <li class="prev disabled">
	                    <a class="paging">&laquo;</a>
	                </li>
	            }
				@for(index <- currentPage.getPagesList) {
					@if(index == currentPage.getCurrentPage) {
						@if(index == currentPage.getMaxViewablePages) {
							<span class="max-viewable-reached hide"></span>
						}
						<li class="active current" id="list-@(index)"><a href="#" class="paging" id="page-@(index)">@(currentPage.getCurrentPage) <span class="sr-only">(current)</span></a></li>
					} else {
						@if(q.mode != null) {
							<li id="list-@(index)"><a href="@link(index, null)@(q.responseParameters)&tab=results&action=search&mode=@(q.mode)" id="page-@(index)" class="paging">@(index)</a></li>
						} else {
							<li id="list-@(index)"><a href="@link(index, null)@(q.responseParameters)&tab=results&action=search" id="page-@(index)" class="paging">@(index)</a></li>
						}
					}
				}
	        	@if(currentPage.hasNextPage && !currentPage.hasMaxViewablePagedReached) {
	                <li class="next" id="list-@(index)">
						@if(q.mode != null) {
                    		<a href="@link(currentPage.getCurrentPage+1, null)@(q.responseParameters)&tab=results&action=search&mode=@(q.mode)" id="page-@(currentPage.getCurrentPage+1)" class="paging" data-toggle="tooltip" data-placement="right" title="Page @(currentPage.getCurrentPage+1)">&raquo;</a>
						} else {
                    		<a href="@link(currentPage.getCurrentPage+1, null)@(q.responseParameters)&tab=results&action=search" id="page-@(currentPage.getCurrentPage+1)" class="paging" data-toggle="tooltip" data-placement="right" title="Page @(currentPage.getCurrentPage+1)">&raquo;</a>
                    	}
	                </li>
	            } else {
	                <li class="next disabled">
	                    <a class="paging">&raquo;</a>
	                </li>
				}
			</ul>
			@if(user != null) {
				<div class="form-group pull-right save-right">
					<button type="button" class="btn btn-primary save-right save-corpus" name="action" value="corpus-save" data-toggle="tooltip" data-placement="right" title="Corpus Save">Save Selected</button>
			    </div>
			}
		</div>
	}
}

@formatDate(dateText: Object) = @{
    if (dateText != null) {
    	var dateValue = dateText.toString
    	var formatter: java.text.DateFormat = new java.text.SimpleDateFormat("E MMM dd HH:mm:ss Z yyyy")
    	var date = formatter.parse(dateValue)
    	val newDate = new java.text.SimpleDateFormat("MMM dd yyyy HH:mm:ss z").format(date)
    	newDate
	} else {
		""
	}
}

@resultSnippet(d: org.apache.solr.common.SolrDocument, index: Int) = {
	<div class="list-group">
		<div class="list-group-item" href="#">
			<h4 class="list-group-item-heading">
				@(currentPage.getNextIndex(index)) <a href="http://web.archive.org/web/@(d.getFirstValue("wayback_date"))/@(d.getFirstValue("url"))">"@d.getFirstValue("title")"</a>
			</h4>
			<div class="checkbox pull-right">
				<input type="checkbox" name="selectedResource" value="@d.getFirstValue("id")" data-toggle="tooltip" data-placement="top" title="Select" class="resource">
			</div>
			<p class="list-group-item-text">
					@formatDate(d.getFirstValue("crawl_date"))<br />
					@d.getFirstValue("content_type_norm")<br />
					@d.getFirstValue("domain")<br />
					@d.getFirstValue("sentiment_score")
			</p>
			@if(q.res.getHighlighting().get(d.getFirstValue("id")) != null) {
			<hr />
				@if(q.res.getHighlighting().get(d.getFirstValue("id")).get("title") != null) {
     						<p class="list-group-item-text">@(Html(q.res.getHighlighting().get(d.getFirstValue("id")).get("title").get(0)))</p>
				}
				@if(q.res.getHighlighting().get(d.getFirstValue("id")).get("url") != null) {
     						<p class="list-group-item-text">@(Html(q.res.getHighlighting().get(d.getFirstValue("id")).get("url").get(0)))</p>
				}
 					@if(q.res.getHighlighting().get(d.getFirstValue("id")).get("content_text") != null) {
 						<p class="list-group-item-text">@(Html(q.res.getHighlighting().get(d.getFirstValue("id")).get("content_text").get(0)))</p>
 					}
			}
		</div>
	</div>
}

<div class="panel-body">

	@pagination

	<div id="concordance-set">
		@if(q != null) {
			@for((d, index) <- q.res.getResults().zipWithIndex) {
				@(resultSnippet(d, index))
			}
		}
	</div>
	
	@pagination
	
</div>

